<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Environmental Dashboard</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background:linear-gradient(135deg,#1ce0e7,#c48a34);
  min-height:100vh;
}
.glass{
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(15px);
  border-radius:20px;
  border:1px solid rgba(255,255,255,0.3);
  box-shadow:0 8px 32px rgba(0,0,0,0.2);
  color:white;
}
.card{
  background:rgba(255,255,255,0.2);
  backdrop-filter:blur(10px);
  border:none;
  color:white;
}
canvas{
  height:350px !important;
}
</style>
</head>

<body>

<nav class="navbar navbar-expand-lg glass m-3 px-4">
  <a class="navbar-brand text-white fw-bold" href="#">Env Monitor</a>
  <div class="ms-auto">
    <a href="index.html" class="btn btn-outline-light me-2">Dashboard</a>
    <a href="logs.html" class="btn btn-outline-light">Logs</a>
  </div>
</nav>

<div class="container">

<div class="glass text-center p-4 mb-4">
  <h1>Environmental Monitoring Dashboard</h1>
</div>

<div class="row g-4">

<div class="col-12">
<div class="card p-3">
<h5>Temperature (°C)</h5>
<canvas id="tempChart"></canvas>
</div>
</div>

<div class="col-12">
<div class="card p-3">
<h5>Humidity (%RH)</h5>
<canvas id="humChart"></canvas>
</div>
</div>

<div class="col-12">
<div class="card p-3">
<h5>PM2.5 (µg/m³)</h5>
<canvas id="pm25Chart"></canvas>
</div>
</div>

<div class="col-12">
<div class="card p-3">
<h5>PM10 (µg/m³)</h5>
<canvas id="pm10Chart"></canvas>
</div>
</div>

<!-- ⭐ เพิ่ม Gas ตรงนี้ -->
<div class="col-12">
<div class="card p-3">
<h5>Gas Level (MQ2)</h5>
<canvas id="gasChart"></canvas>
</div>
</div>

</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDaAWmaVhmihX3V2aToTpFFSnhwhl3mNSs",
  authDomain: "pj-smoke-part-2.firebaseapp.com",
  databaseURL: "https://pj-smoke-part-2-default-rtdb.asia-southeast1.firebasedatabase.app/",
  projectId: "pj-smoke-part-2"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let labels=[],tempData=[],humData=[],pm25Data=[],pm10Data=[],gasData=[];

function createChart(id,label,data){
  return new Chart(document.getElementById(id),{
    type:'line',
    data:{
      labels:labels,
      datasets:[{
        label:label,
        data:data,
        borderColor:"#000000",
        borderWidth:2,
        tension:0.4,
        fill:false
      }]
    },
    options:{
      responsive:true,
      maintainAspectRatio:false,
      scales:{
        x:{ticks:{color:"#000"}},
        y:{ticks:{color:"#000"}}
      },
      plugins:{legend:{labels:{color:"#000"}}}
    }
  });
}

let tempChart=createChart("tempChart","Temperature (°C)",tempData);
let humChart=createChart("humChart","Humidity (%RH)",humData);
let pm25Chart=createChart("pm25Chart","PM2.5 (µg/m³)",pm25Data);
let pm10Chart=createChart("pm10Chart","PM10 (µg/m³)",pm10Data);
let gasChart=createChart("gasChart","Gas Level",gasData); // ⭐ เพิ่ม

onValue(ref(db,"envLogs"),(snapshot)=>{

  let t=[],h=[],p25=[],p10=[],g=[],time=[];

  snapshot.forEach(child=>{
    let d=child.val();

    time.push(
      new Date(d.timestamp * 1000).toLocaleTimeString("en-GB", {
        timeZone: "Asia/Bangkok",
        hour12: false
      })
    );

    t.push(d.temperature);
    h.push(d.humidity);
    p25.push(d.pm25);
    p10.push(d.pm10);
    g.push(d.gas);  // ⭐ อ่านค่า gas
  });

  labels=time.slice(-8);
  tempData=t.slice(-8);
  humData=h.slice(-8);
  pm25Data=p25.slice(-8);
  pm10Data=p10.slice(-8);
  gasData=g.slice(-8);

  tempChart.data.labels=labels;
  tempChart.data.datasets[0].data=tempData;
  tempChart.update();

  humChart.data.labels=labels;
  humChart.data.datasets[0].data=humData;
  humChart.update();

  pm25Chart.data.labels=labels;
  pm25Chart.data.datasets[0].data=pm25Data;
  pm25Chart.update();

  pm10Chart.data.labels=labels;
  pm10Chart.data.datasets[0].data=pm10Data;
  pm10Chart.update();

  gasChart.data.labels=labels;         // ⭐ update gas
  gasChart.data.datasets[0].data=gasData;
  gasChart.update();
});
</script>

</body>
</html>